<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Lottery Pro Max - Multi Prize Fixed</title>

<style>
    :root {
        --primary: #bb86fc;
        --secondary: #03dac6;
        --bg: #0f0f12;
        --card: #1e1e26;
        --text: #ffffff;
        --text-dim: #b0b0b0;
        --danger: #cf6679;
        --glass: rgba(255, 255, 255, 0.05);
    }

    body {
        margin: 0; font-family: 'Segoe UI', sans-serif;
        background-color: var(--bg); color: var(--text);
        display: flex; justify-content: center; min-height: 100vh;
    }

    .app-container { width: 100%; max-width: 480px; padding: 15px; box-sizing: border-box; padding-bottom: 80px; }

    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .brand { font-size: 20px; font-weight: 800; background: linear-gradient(45deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    .undo-mini { 
        background: #ff9800; color: black; 
        width: 32px; height: 32px; 
        border-radius: 50%; 
        display: none;
        align-items: center; justify-content: center; 
        font-size: 18px; cursor: pointer; border: none;
        box-shadow: 0 0 10px rgba(255,152,0,0.4);
    }

    .stats-bar {
        background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px;
        display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass);
    }
    .stat-item span { display: block; color: var(--text-dim); font-size: 11px; text-transform: uppercase; }
    .stat-item b { font-size: 20px; color: var(--secondary); }

    .action-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
    .action-btn { background: var(--glass); border: 1px solid var(--glass); color: white; padding: 8px; border-radius: 12px; font-size: 11px; cursor: pointer; text-align: center; }

    .input-group { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--glass); position: sticky; top: 0; z-index: 100; }
    input, select, textarea {
        background: rgba(255,255,255,0.07); border: 1px solid transparent; border-radius: 12px;
        padding: 12px; color: white; font-size: 16px; width: 100%; box-sizing: border-box; margin: 5px 0;
    }
    .input-focus { border-color: var(--primary) !important; background: rgba(255,255,255,0.1) !important; outline: none; box-shadow: 0 0 8px var(--primary); }

    .btn-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
    button { border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .btn-p { background: var(--primary); color: #000; padding: 12px; }
    .btn-s { background: var(--secondary); color: #000; padding: 12px; }
    .btn-o { background: #f57c00; color: white; padding: 12px; }
    .btn-blue { background: #0288d1; color: white; padding: 12px; }

    .tabs-wrapper { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
    .tab { background: var(--card); padding: 8px 16px; border-radius: 15px; white-space: nowrap; font-size: 13px; border: 1px solid var(--glass); }
    .tab.active { background: var(--primary); color: black; font-weight: bold; }

    .data-list { background: var(--card); border-radius: 20px; max-height: 400px; overflow-y: auto; border: 1px solid var(--glass); scroll-behavior: smooth; }
    .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid var(--glass); }
    .list-item b { color: var(--primary); font-size: 18px; }

    .keypad {
        position: fixed; bottom: -400px; left: 0; width: 100%; background: #181820; padding: 15px;
        border-radius: 30px 30px 0 0; z-index: 3000; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 -10px 40px rgba(0,0,0,0.5); box-sizing: border-box;
    }
    .keypad-show { bottom: 0; }
    .k-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px; }
    .k-btn { background: #2a2a35; height: 50px; border-radius: 12px; font-size: 20px; color: white; border: none; }

    .keyboard-active-padding { padding-bottom: 300px !important; }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 4000; backdrop-filter: blur(5px); padding: 15px; }
    .modal { background: var(--card); width: 100%; max-width: 400px; padding: 20px; border-radius: 25px; border: 1px solid var(--glass); max-height: 90vh; overflow-y: auto; }
    .flex { display: flex !important; }
    .hidden { display: none !important; }
</style>
</head>
<body onclick="hideKeypadOnOutside(event)" onload="initApp()">

<div class="app-container" id="mainContainer">
    <div class="header">
        <div class="brand">LOTTERY PRO MAX</div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <button id="undoMini" class="undo-mini" onclick="undoClear()">‚Ü©Ô∏è</button>
            <button onclick="toggleModal('settingsModal')" style="background:none; font-size:22px; border:none; color:white; cursor:pointer;">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><span>Total Count</span><b id="liveTotal">0</b></div>
        <div style="display: flex; gap: 8px;">
            <button class="btn-s" onclick="share()" style="padding: 8px 15px; font-size: 12px;">SHARE</button>
            <button class="btn-p" onclick="openHistory()" style="padding: 8px 15px; font-size: 12px;">HISTORY</button>
        </div>
    </div>

    <div class="action-row">
        <div class="action-btn" onclick="toggleModal('smartModal')">üöÄ SMART</div>
        <div class="action-btn" onclick="sortCurrentList()">üìä SORT</div>
        <div class="action-btn" onclick="saveDay()">üíæ SAVE</div>
        <div class="action-btn" onclick="resetTab()" style="color:var(--danger)">üóëÔ∏è CLEAR</div>
    </div>

    <div class="tabs-wrapper" id="tabsList"></div>

    <div class="input-group">
        <input id="customer" placeholder="Customer Name" oninput="updateTabName()">
        <div style="display: flex; gap: 8px;">
            <select id="posSelect" style="flex: 1; background: #37474f;">
                <option value="ABC">ABC</option>
                <option value="A">A</option><option value="B">B</option><option value="C">C</option>
                <option value="AB">AB</option><option value="BC">BC</option><option value="AC">AC</option>
            </select>
            <input id="num" placeholder="No" readonly onclick="setFocus('num', event)" style="flex: 1.5;">
            <input id="count" placeholder="Count" readonly onclick="setFocus('count', event)" style="flex: 1.5;">
        </div>
        <div class="btn-row">
            <button class="btn-p" onclick="addEntry()">ADD</button>
            <button class="btn-o" onclick="addBoxEntry()">BOX</button>
            <button class="btn-blue" onclick="toggleStep(true)">STEP</button>
        </div>
    </div>

    <div id="stepEntry" class="input-group hidden">
        <div style="display:flex; gap:8px;">
            <input id="stepStart" placeholder="Start" readonly onclick="setFocus('stepStart', event)">
            <input id="stepEnd" placeholder="End" readonly onclick="setFocus('stepEnd', event)">
        </div>
        <div style="display:flex; gap:8px;">
            <input id="stepGap" placeholder="Gap" value="1" readonly onclick="setFocus('stepGap', event)">
            <input id="stepCount" placeholder="Count" readonly onclick="setFocus('stepCount', event)">
        </div>
        <div class="btn-row" style="grid-template-columns: 1fr 1fr;">
            <button class="btn-s" onclick="processStep()">PROCESS</button>
            <button class="btn-d" onclick="toggleStep(false)" style="background:var(--danger); color:white; padding:12px; border-radius:12px;">CANCEL</button>
        </div>
    </div>

    <div class="data-list" id="liveList"></div>
</div>

<div id="customKeypad" class="keypad">
    <div class="k-row">
        <button class="k-btn" onclick="press('1')">1</button>
        <button class="k-btn" onclick="press('2')">2</button>
        <button class="k-btn" onclick="press('3')">3</button>
    </div>
    <div class="k-row">
        <button class="k-btn" onclick="press('4')">4</button>
        <button class="k-btn" onclick="press('5')">5</button>
        <button class="k-btn" onclick="press('6')">6</button>
    </div>
    <div class="k-row">
        <button class="k-btn" onclick="press('7')">7</button>
        <button class="k-btn" onclick="press('8')">8</button>
        <button class="k-btn" onclick="press('9')">9</button>
    </div>
    <div class="k-row">
        <button class="k-btn" style="color:var(--danger)" onclick="press('DEL')">‚å´</button>
        <button class="k-btn" onclick="press('0')">0</button>
        <button class="k-btn" style="background:var(--primary); color:black;" onclick="handleEnter()">OK</button>
    </div>
</div>

<div id="historyPage" class="overlay">
    <div class="modal">
        <h3 style="color:var(--primary)">History & Winnings</h3>
        <textarea id="winningPaste" placeholder="Paste Winning List..."></textarea>
        <button class="btn-s" style="width:100%" onclick="checkWinners()">CHECK WINNERS</button>
        <div id="winDisplay" class="hidden" style="background:rgba(3,218,198,0.1); padding:15px; border-radius:15px; margin-top:10px; border:1px solid var(--secondary);">
            <div id="winContent" style="white-space:pre-wrap; font-family:monospace; font-size:12px;"></div>
            <div style="font-weight:bold; margin-top:10px; color:var(--secondary);">Total Win: <span id="totalWinAmount">‚Çπ0</span></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <button class="btn-s" onclick="shareWinningList()" style="flex:1; background:#25D366">WhatsApp</button>
                <button class="btn-p" onclick="copyWinningList()" style="flex:1">Copy</button>
            </div>
        </div>
        <hr style="opacity:0.1; margin:15px 0;">
        <div id="savedList" class="data-list"></div>
        <div class="btn-row" style="grid-template-columns: 1fr 1fr; margin-top:15px;">
            <button class="btn-p" onclick="renderSaved(true)">MERGE & SORT</button>
            <button class="btn-s" style="background:#25D366" onclick="shareMergedData()">SHARE ALL</button>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
            <button class="btn-p" style="background:#444; color:white; padding:12px;" onclick="closeModals()">BACK</button>
            <button class="btn-p" style="background:var(--danger); color:white; padding:12px;" onclick="clearAllHistory()">CLEAR ALL</button>
        </div>
    </div>
</div>

<div id="smartModal" class="overlay">
    <div class="modal">
        <h3>Smart Paste</h3>
        <textarea id="smartPaste" placeholder="Paste data here..." style="height:150px;"></textarea>
        <button class="btn-s" style="width:100%; margin-top:10px;" onclick="processSmartPaste()">ADD DATA</button>
        <button class="btn-p" style="width:100%; margin-top:10px; background:#444; color:white;" onclick="closeModals()">CLOSE</button>
    </div>
</div>

<div id="settingsModal" class="overlay">
    <div class="modal">
        <h3>Settings</h3>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <span>Merge Duplicates</span>
            <input type="checkbox" id="mergeToggle" style="width:25px;">
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <span>Entry Sound</span>
            <input type="checkbox" id="soundToggle" checked style="width:25px;">
        </div>
        <button class="btn-p" style="width:100%" onclick="saveSettings()">SAVE & CLOSE</button>
    </div>
</div>

<script>
    let customers = JSON.parse(localStorage.getItem("lottery_customers")) || [{name: "", temp: []}];
    let activeIndex = 0;
    let permanent = JSON.parse(localStorage.getItem("perm_list")) || [];
    let currentInputId = 'num';
    let isNewInput = false;
    let lastDeletedData = null;
    let lastWinDetails = "";

    function initApp() { renderTabs(); loadSettings(); }

    function renderTabs() {
        let h = "";
        customers.forEach((c, i) => h += `<div class="tab ${i === activeIndex ? 'active' : ''}" onclick="switchTab(${i})">${c.name || 'User '+(i+1)}</div>`);
        h += `<div class="tab" onclick="addTab()" style="background:var(--secondary); color:black;">+</div>`;
        document.getElementById("tabsList").innerHTML = h;
        document.getElementById("customer").value = customers[activeIndex].name;
        renderLive();
    }

    function switchTab(i) { activeIndex = i; renderTabs(); }
    function addTab() { customers.push({name: "", temp: []}); activeIndex = customers.length - 1; renderTabs(); }
    function updateTabName() { customers[activeIndex].name = document.getElementById("customer").value; save(); renderTabs(); }

    function setFocus(id, e) {
        e.stopPropagation(); currentInputId = id; isNewInput = true;
        document.querySelectorAll('input').forEach(i => i.classList.remove('input-focus'));
        document.getElementById(id).classList.add('input-focus');
        document.getElementById("customKeypad").classList.add("keypad-show");
        document.getElementById("mainContainer").classList.add("keyboard-active-padding");
    }

    function hideKeypadOnOutside(e) { 
        if(!e.target.closest('.keypad') && !e.target.closest('input')) { 
            document.getElementById("customKeypad").classList.remove("keypad-show"); 
            document.querySelectorAll('input').forEach(i => i.classList.remove('input-focus'));
            document.getElementById("mainContainer").classList.remove("keyboard-active-padding");
        } 
    }

    function press(k) {
        let el = document.getElementById(currentInputId);
        if(isNewInput && k !== 'DEL') { el.value = ""; isNewInput = false; }
        if(k === 'DEL') el.value = el.value.slice(0, -1);
        else el.value += k;
        if(currentInputId === 'num') {
            let p = document.getElementById("posSelect").value;
            let max = (p === 'ABC') ? 3 : (p.length === 2 ? 2 : 1);
            if(el.value.length >= max) { setFocus('count', {stopPropagation:()=>{}}); }
        }
        playSnd();
    }

    function handleEnter() {
        if(currentInputId === 'count' || currentInputId === 'stepCount') addEntry();
        else { setFocus(currentInputId === 'num' ? 'count' : 'num', {stopPropagation:()=>{}}); }
    }

    function addEntry() {
        let n = document.getElementById("num").value, c = parseInt(document.getElementById("count").value), p = document.getElementById("posSelect").value;
        if(!n || isNaN(c)) return;
        n = n.padStart(p==='ABC'?3:p.length, '0');
        let merged = false;
        if(document.getElementById("mergeToggle").checked) {
            let idx = customers[activeIndex].temp.findIndex(i => i.p === p && i.n === n);
            if(idx > -1) { customers[activeIndex].temp[idx].c += c; merged = true; }
        }
        if(!merged) customers[activeIndex].temp.unshift({p, n, c, time: Date.now()});
        document.getElementById("num").value = ""; 
        setFocus('num', {stopPropagation:()=>{}}); 
        renderLive(); save();
    }

    function addBoxEntry() {
        let n = document.getElementById("num").value, c = parseInt(document.getElementById("count").value);
        if(!n || isNaN(c)) return;
        let s = n.padStart(3, '0').split(''), res = [];
        for(let i=0;i<3;i++) for(let j=0;j<3;j++) for(let k=0;k<3;k++) if(i!==j && j!==k && i!==k) res.push(s[i]+s[j]+s[k]);
        [...new Set(res)].forEach(bx => {
            let idx = customers[activeIndex].temp.findIndex(i => i.p === "ABC" && i.n === bx);
            if(idx > -1 && document.getElementById("mergeToggle").checked) customers[activeIndex].temp[idx].c += c;
            else customers[activeIndex].temp.unshift({p: "ABC", n: bx, c: c, time: Date.now()});
        });
        document.getElementById("num").value = "";
        setFocus('num', {stopPropagation:()=>{}});
        renderLive(); save();
    }

    function renderLive() {
        let h = ""; let t = 0;
        customers[activeIndex].temp.forEach((item, i) => {
            h += `<div class="list-item"><div><span>${item.p}</span> <b>${item.n}</b></div><div style="display:flex; align-items:center; gap:15px;"><b>${item.c}</b><button onclick="delItem(${i})" style="background:none; color:var(--danger); font-size:18px; border:none;">‚úï</button></div></div>`;
            t += item.c;
        });
        document.getElementById("liveList").innerHTML = h || "<p style='text-align:center; padding:20px; color:var(--text-dim)'>No Data</p>";
        document.getElementById("liveTotal").innerText = t;
    }

    function share() {
        let d = [...customers[activeIndex].temp];
        let n = document.getElementById("customer").value || "Customer";
        if(d.length === 0) return;
        lastDeletedData = { name: n, temp: [...d], index: activeIndex, lastCount: document.getElementById("count").value };
        document.getElementById("undoMini").style.display = "flex"; 
        let txt = `üíé *${n}*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        let t = 0;
        d.forEach(i => { txt += `‚ñ´Ô∏è ${i.p} ${i.n} : ${i.c}\n`; t += i.c; });
        txt += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚úÖ *Total: ${t}*`;
        customers[activeIndex].temp = []; 
        customers[activeIndex].name = "";
        document.getElementById("customer").value = "";
        document.getElementById("count").value = ""; 
        renderTabs(); save();
        window.location.href = "whatsapp://send?text=" + encodeURIComponent(txt);
    }

    function undoClear() {
        if(lastDeletedData) {
            customers[lastDeletedData.index].temp = lastDeletedData.temp;
            customers[lastDeletedData.index].name = lastDeletedData.name;
            document.getElementById("count").value = lastDeletedData.lastCount;
            document.getElementById("undoMini").style.display = "none";
            renderTabs(); save();
        }
    }

    function delItem(i) { if(confirm("‡¥°‡¥ø‡¥≤‡µÄ‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡µã?")) { customers[activeIndex].temp.splice(i, 1); renderLive(); save(); } }
    function sortCurrentList() { customers[activeIndex].temp.sort((a,b) => b.c - a.c); renderLive(); }
    function resetTab() { if(confirm("‡¥ü‡¥æ‡¥¨‡µç ‡¥ï‡µç‡¥≤‡¥ø‡¥Ø‡µº ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡µã?")) { customers[activeIndex].temp = []; customers[activeIndex].name = ""; document.getElementById("customer").value = ""; renderTabs(); save(); } }
    function saveDay() { if(customers[activeIndex].temp.length > 0) { permanent = [...permanent, ...customers[activeIndex].temp]; localStorage.setItem("perm_list", JSON.stringify(permanent)); alert("History Saved!"); } }

    function checkWinners() {
        let winText = document.getElementById("winningPaste").value;
        let found = winText.match(/\d{3}/g);
        if(!found) return;
        
        let first = found[0], wA = first[0], wB = first[1], wC = first[2];
        let rep = [], total = 0;
        
        permanent.forEach(i => {
            let itemTotalPrize = 0;
            let itemPrizeNames = [];

            if(i.p === "ABC") {
                // ‡¥í‡¥®‡µç‡¥®‡¥ø‡¥≤‡¥ß‡¥ø‡¥ï‡¥Ç ‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥í‡¥∞‡µá ‡¥®‡¥Æ‡µç‡¥™‡µº ‡¥µ‡¥®‡µç‡¥®‡¥æ‡¥≤‡µÅ‡¥Ç ‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç ‡¥ï‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥Ç
                if(i.n === found[0]) { itemTotalPrize += 5400; itemPrizeNames.push("1st"); }
                if(i.n === found[1]) { itemTotalPrize += 550; itemPrizeNames.push("2nd"); }
                if(i.n === found[2]) { itemTotalPrize += 270; itemPrizeNames.push("3rd"); }
                if(i.n === found[3]) { itemTotalPrize += 120; itemPrizeNames.push("4th"); }
                if(i.n === found[4]) { itemTotalPrize += 80; itemPrizeNames.push("5th"); }
                
                // 6-‡¥æ‡¥Ç ‡¥∏‡¥Æ‡µç‡¥Æ‡¥æ‡¥®‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥Ö‡µº‡¥π‡¥Æ‡¥æ‡¥£‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ (‡¥®‡µá‡¥∞‡¥§‡µç‡¥§‡µÜ ‡¥ï‡¥ø‡¥ü‡µç‡¥ü‡¥ø‡¥Ø‡¥µ ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡¥ø)
                let isSixth = false;
                for(let idx=5; idx<found.length; idx++) {
                    if(i.n === found[idx]) { isSixth = true; break; }
                }
                if(isSixth) { itemTotalPrize += 35; itemPrizeNames.push("6th+"); }
                
            } else if(i.p === "A" && i.n === wA) { itemTotalPrize += 80; itemPrizeNames.push("A"); }
            else if(i.p === "B" && i.n === wB) { itemTotalPrize += 80; itemPrizeNames.push("B"); }
            else if(i.p === "C" && i.n === wC) { itemTotalPrize += 80; itemPrizeNames.push("C"); }
            
            if(itemTotalPrize > 0) {
                let pLabel = "(" + itemPrizeNames.join("+") + ")";
                rep.push(`üí† ${i.n} ${pLabel} ¬ª ${i.c} √ó ${itemTotalPrize} = ${i.c * itemTotalPrize}`);
                total += i.c * itemTotalPrize;
            }
        });
        
        document.getElementById("winDisplay").classList.remove("hidden");
        document.getElementById("winContent").innerText = rep.join("\n") || "No Winners";
        document.getElementById("totalWinAmount").innerText = "‚Çπ" + total;
        lastWinDetails = `‚ú® *WIN REPORT* ‚ú®\n\n${rep.join("\n")}\n\nüíµ *Total: ‚Çπ${total}*`;
    }

    function shareWinningList() { window.location.href = "whatsapp://send?text=" + encodeURIComponent(lastWinDetails); }
    function copyWinningList() { navigator.clipboard.writeText(lastWinDetails); alert("Copied!"); }
    
    function processSmartPaste() {
        let text = document.getElementById("smartPaste").value;
        let regex = /(\d{3})(?:[^\d]+)(\d+)/g, m;
        while ((m = regex.exec(text)) !== null) { let n = m[1], c = parseInt(m[2]); customers[activeIndex].temp.unshift({p: "ABC", n: n, c: c, time: Date.now()}); }
        closeModals(); renderLive(); save();
    }

    function toggleModal(id) { document.getElementById(id).classList.add("flex"); }
    function closeModals() { document.querySelectorAll('.overlay').forEach(m => m.classList.remove('flex')); }
    function openHistory() { toggleModal('historyPage'); renderSaved(); }
    
    function renderSaved(m = false) {
        let list = [...permanent];
        if(m) { 
            let dict = {}; 
            list.forEach(i => { 
                let k=i.p+"-"+i.n; 
                dict[k] = (dict[k] || {p:i.p, n:i.n, c:0}); 
                dict[k].c += i.c; 
            }); 
            list = Object.values(dict).sort((a,b) => b.c - a.c); 
        } else {
            list = list.slice().reverse();
        }
        let h = ""; list.forEach(i => h += `<div class="list-item"><span>${i.p} ${i.n}</span> <b>${i.c}</b></div>`);
        document.getElementById("savedList").innerHTML = h;
    }

    function shareMergedData() {
        let dict = {}; permanent.forEach(i => { let k=i.p+"-"+i.n; dict[k] = (dict[k] || {p:i.p, n:i.n, c:0}); dict[k].c += i.c; });
        let txt = `üìë *MERGED LIST*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        Object.values(dict).sort((a,b)=> b.c - a.c).forEach(i => txt += `‚ñ´Ô∏è ${i.p} ${i.n} : ${i.c}\n`);
        window.location.href = "whatsapp://send?text=" + encodeURIComponent(txt);
    }

    function clearAllHistory() { if(confirm("‡¥ï‡µç‡¥≤‡¥ø‡¥Ø‡µº ‡¥π‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥±‡¥ø?")) { permanent = []; localStorage.setItem("perm_list", "[]"); renderSaved(); } }
    function save() { localStorage.setItem("lottery_customers", JSON.stringify(customers)); }
    function loadSettings() { document.getElementById("mergeToggle").checked = localStorage.getItem("merge") === 'true'; document.getElementById("soundToggle").checked = localStorage.getItem("sound") !== 'false'; }
    function saveSettings() { localStorage.setItem("merge", document.getElementById("mergeToggle").checked); localStorage.setItem("sound", document.getElementById("soundToggle").checked); closeModals(); }
    function playSnd() { if(document.getElementById("soundToggle").checked) { let a = new AudioContext(); let o = a.createOscillator(); let g = a.createGain(); o.connect(g); g.connect(a.destination); o.frequency.value = 850; g.gain.value = 0.05; o.start(); o.stop(a.currentTime + 0.08); } }
    function toggleStep(s) { document.getElementById("stepEntry").classList.toggle("hidden", !s); if(s) setFocus('stepStart', {stopPropagation:()=>{}}); }
    
    function processStep() {
        let s = parseInt(document.getElementById("stepStart").value), e = parseInt(document.getElementById("stepEnd").value), c = parseInt(document.getElementById("stepCount").value), g = parseInt(document.getElementById("stepGap").value) || 1, p = document.getElementById("posSelect").value;
        for(let i=s; i<=e; i+=g) { let n = i.toString().padStart(p==='ABC'?3:p.length,'0'); customers[activeIndex].temp.unshift({p, n, c, time: Date.now()}); }
        toggleStep(false); renderLive(); save();
    }
</script>
</body>
</html>
